<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test Checkout - Fuel & Flex</title>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background: #f5f5f5;
        }
        .test-section {
            background: white;
            padding: 20px;
            margin: 20px 0;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .status {
            padding: 10px;
            border-radius: 4px;
            margin: 10px 0;
        }
        .success { background: #d4edda; color: #155724; }
        .error { background: #f8d7da; color: #721c24; }
        .info { background: #d1ecf1; color: #0c5460; }
        button {
            background: #007bff;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 4px;
            cursor: pointer;
            margin: 5px;
        }
        button:hover { background: #0056b3; }
        .cart-item {
            border: 1px solid #ddd;
            padding: 10px;
            margin: 5px 0;
            border-radius: 4px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .totals {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 4px;
            margin: 10px 0;
        }
        .total-row {
            display: flex;
            justify-content: space-between;
            margin: 5px 0;
        }
        .total-row.final {
            font-weight: bold;
            font-size: 1.2em;
            border-top: 2px solid #007bff;
            padding-top: 10px;
        }
    </style>
</head>
<body>
    <h1>Checkout System Test</h1>
    
    <div class="test-section">
        <h2>Cart Setup</h2>
        <button onclick="setupTestCart()">Setup Test Cart</button>
        <button onclick="clearCart()">Clear Cart</button>
        <button onclick="showCurrentCart()">Show Current Cart</button>
        <div id="cart-status"></div>
    </div>

    <div class="test-section">
        <h2>Cart Items</h2>
        <div id="cart-display"></div>
    </div>

    <div class="test-section">
        <h2>Order Totals</h2>
        <div id="totals-display" class="totals">
            <div class="total-row">
                <span>Subtotal:</span>
                <span id="test-subtotal">₹0</span>
            </div>
            <div class="total-row">
                <span>Shipping:</span>
                <span id="test-shipping">₹0</span>
            </div>
            <div class="total-row">
                <span>Tax (6%):</span>
                <span id="test-tax">₹0</span>
            </div>
            <div class="total-row final">
                <span>Total:</span>
                <span id="test-total">₹0</span>
            </div>
        </div>
        <button onclick="calculateTotals()">Calculate Totals</button>
    </div>

    <div class="test-section">
        <h2>Promo Code Test</h2>
        <p>Available promo codes: <strong>WELCOME10</strong> and <strong>PARAM10</strong> (both give 10% discount)</p>
        <button onclick="testPromoCode('WELCOME10')">Test WELCOME10</button>
        <button onclick="testPromoCode('PARAM10')">Test PARAM10</button>
        <button onclick="testPromoCode('INVALID')">Test Invalid Code</button>
        <div id="promo-result"></div>
    </div>

    <div class="test-section">
        <h2>Checkout Actions</h2>
        <button onclick="goToCheckout()">Go to Checkout Page</button>
        <div id="checkout-result"></div>
    </div>

    <script src="config.js"></script>
    <script>
        // Test cart data
        const testCartItems = [
            {
                id: 1,
                name: "Whey Protein pro",
                price: 2499,
                image: "prot.jpg",
                quantity: 2
            },
            {
                id: 7,
                name: "Performance Tank Top",
                price: 699,
                image: "tanktop.jpg",
                quantity: 1
            },
            {
                id: 3,
                name: "BCAA Amino Acids",
                price: 1100,
                image: "BCAA.webp",
                quantity: 1
            }
        ];

        function showStatus(elementId, message, type) {
            const element = document.getElementById(elementId);
            element.innerHTML = `<div class="status ${type}">${message}</div>`;
        }

        function setupTestCart() {
            localStorage.setItem('cart', JSON.stringify(testCartItems));
            showStatus('cart-status', 'Test cart setup complete! Cart now contains 3 items.', 'success');
            showCurrentCart();
            calculateTotals();
        }

        function clearCart() {
            localStorage.removeItem('cart');
            showStatus('cart-status', 'Cart cleared!', 'info');
            document.getElementById('cart-display').innerHTML = '';
            calculateTotals();
        }

        function showCurrentCart() {
            const cartData = localStorage.getItem('cart');
            const cartDisplay = document.getElementById('cart-display');
            
            if (!cartData) {
                cartDisplay.innerHTML = '<div class="status info">Cart is empty</div>';
                return;
            }

            const cart = JSON.parse(cartData);
            cartDisplay.innerHTML = '';

            cart.forEach(item => {
                const cartItem = document.createElement('div');
                cartItem.className = 'cart-item';
                cartItem.innerHTML = `
                    <div>
                        <strong>${item.name}</strong><br>
                        ₹${item.price.toLocaleString('en-IN')} × ${item.quantity}
                    </div>
                    <div>
                        <strong>₹${(item.price * item.quantity).toLocaleString('en-IN')}</strong>
                    </div>
                `;
                cartDisplay.appendChild(cartItem);
            });
        }

        function calculateTotals(discount = 0) {
            const cartData = localStorage.getItem('cart');

            if (!cartData) {
                document.getElementById('test-subtotal').textContent = '₹0';
                document.getElementById('test-shipping').textContent = '₹0';
                document.getElementById('test-tax').textContent = '₹0';
                document.getElementById('test-total').textContent = '₹0';
                return;
            }

            const cart = JSON.parse(cartData);
            const subtotal = cart.reduce((sum, item) => sum + (item.price * item.quantity), 0);
            const shipping = subtotal > 899 ? 0 : 99; // Free shipping over ₹899
            const tax = Math.round(subtotal * 0.06); // 6% Tax
            const discountAmount = Math.round(subtotal * discount);
            const total = subtotal + shipping + tax - discountAmount;

            document.getElementById('test-subtotal').textContent = `₹${subtotal.toLocaleString('en-IN')}`;
            document.getElementById('test-shipping').textContent = `₹${shipping.toLocaleString('en-IN')}`;
            document.getElementById('test-tax').textContent = `₹${tax.toLocaleString('en-IN')}`;
            document.getElementById('test-total').textContent = `₹${total.toLocaleString('en-IN')}`;

            // Show discount if applied
            let discountRow = document.getElementById('discount-test-row');
            if (discount > 0) {
                if (!discountRow) {
                    discountRow = document.createElement('div');
                    discountRow.id = 'discount-test-row';
                    discountRow.className = 'total-row';
                    discountRow.style.color = '#10b981';
                    document.getElementById('totals-display').insertBefore(discountRow, document.querySelector('.total-row.final'));
                }
                discountRow.innerHTML = `<span>Discount:</span><span>-₹${discountAmount.toLocaleString('en-IN')}</span>`;
            } else if (discountRow) {
                discountRow.remove();
            }
        }

        function testPromoCode(code) {
            const promoCodes = {
                'WELCOME10': 0.1,
                'PARAM10': 0.1
            };

            if (promoCodes[code]) {
                showStatus('promo-result', `✅ ${code} is valid! Applying 10% discount...`, 'success');
                calculateTotals(promoCodes[code]);
            } else {
                showStatus('promo-result', `❌ ${code} is invalid!`, 'error');
                calculateTotals(0);
            }
        }

        function goToCheckout() {
            const cartData = localStorage.getItem('cart');
            
            if (!cartData) {
                showStatus('checkout-result', 'Please setup a test cart first!', 'error');
                return;
            }

            showStatus('checkout-result', 'Redirecting to checkout page...', 'info');
            setTimeout(() => {
                window.location.href = 'checkout.html';
            }, 1000);
        }

        // Initialize on page load
        document.addEventListener('DOMContentLoaded', () => {
            console.log('Test page loaded');
            showCurrentCart();
            calculateTotals();
        });
    </script>
</body>
</html>
